<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Web Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles if Tailwind isn't enough (e.g., specific gradients or very fine-tuned typography) */
        /* For this calculator, Tailwind should be sufficient. */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* A common, clean system font */
        }

        /* Slight enhancement for button active state for better visual feedback */
        .calculator-btn:active {
            transform: scale(0.95);
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2);
        }

        /* Ensure text in display doesn't overflow and shows ellipsis if too long */
        .display-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-700 flex items-center justify-center min-h-screen p-4 selection:bg-cyan-300 selection:text-cyan-900">

    <main class="w-full max-w-sm">
        <div class="calculator bg-slate-800 shadow-2xl rounded-xl p-5 md:p-6">
            <!-- Display Screen -->
            <div class="display bg-slate-900 text-white p-4 md:p-6 rounded-lg mb-5 md:mb-6 text-right shadow-inner">
                <div data-previous-operand class="previous-operand text-slate-400 text-xl md:text-2xl h-8 display-text"></div>
                <div data-current-operand class="current-operand text-4xl md:text-5xl font-bold h-12 display-text">0</div>
            </div>

            <!-- Buttons Grid -->
            <div class="buttons-grid grid grid-cols-4 gap-2 md:gap-3">
                <button data-all-clear class="calculator-btn col-span-2 bg-red-500 hover:bg-red-600 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75">AC</button>
                <button data-delete class="calculator-btn bg-orange-500 hover:bg-orange-600 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-opacity-75">C</button>
                <button data-operation class="calculator-btn bg-cyan-500 hover:bg-cyan-600 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-opacity-75">÷</button>

                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">7</button>
                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">8</button>
                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">9</button>
                <button data-operation class="calculator-btn bg-cyan-500 hover:bg-cyan-600 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-opacity-75">×</button>

                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">4</button>
                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">5</button>
                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">6</button>
                <button data-operation class="calculator-btn bg-cyan-500 hover:bg-cyan-600 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-opacity-75">-</button>

                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">1</button>
                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">2</button>
                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">3</button>
                <button data-operation class="calculator-btn bg-cyan-500 hover:bg-cyan-600 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-opacity-75">+</button>

                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">0</button>
                <button data-number class="calculator-btn bg-slate-600 hover:bg-slate-500 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-75">.</button>
                <button data-equals class="calculator-btn col-span-2 bg-emerald-500 hover:bg-emerald-600 text-white text-xl md:text-2xl p-3 md:p-4 rounded-lg transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-opacity-75">=</button>
            </div>
        </div>
        <footer class="text-center text-slate-400 mt-6 text-sm">
            A Modern Calculator by AI.
        </footer>
    </main>

    <script>
        class Calculator {
            constructor(previousOperandTextElement, currentOperandTextElement) {
                this.previousOperandTextElement = previousOperandTextElement;
                this.currentOperandTextElement = currentOperandTextElement;
                this.MAX_DISPLAY_LENGTH = 16; // Max characters for current operand
                this.clear();
                this.registerKeyboardListeners();
            }

            clear() {
                this.currentOperand = '0';
                this.previousOperand = '';
                this.operation = undefined;
                this.isResultDisplayed = false; // Flag to check if current operand is a result
                this.updateDisplay();
            }

            delete() {
                if (this.currentOperand === 'Error' || this.isResultDisplayed) {
                    // If it's an error or a result, 'C' should behave like 'AC' for the current input
                    this.currentOperand = '0';
                    this.isResultDisplayed = false;
                } else if (this.currentOperand.length > 1) {
                    this.currentOperand = this.currentOperand.toString().slice(0, -1);
                } else {
                    this.currentOperand = '0'; // If only one digit, set to '0'
                }
                this.updateDisplay();
            }

            appendNumber(number) {
                if (this.currentOperand === 'Error') return;
                // If a result is displayed and user types a number, start a new calculation
                if (this.isResultDisplayed) {
                    this.currentOperand = '';
                    this.isResultDisplayed = false;
                }
                if (number === '.' && this.currentOperand.includes('.')) return; // Prevent multiple decimals
                if (this.currentOperand === '0' && number !== '.') {
                    this.currentOperand = number.toString();
                } else {
                    if (this.currentOperand.length < this.MAX_DISPLAY_LENGTH) {
                        this.currentOperand = this.currentOperand.toString() + number.toString();
                    }
                }
                this.updateDisplay();
            }

            chooseOperation(operation) {
                if (this.currentOperand === 'Error') return;
                if (this.currentOperand === '' && this.previousOperand === '') return; // Nothing to operate on

                // If user types 5 * then -, change operation to -
                if (this.currentOperand === '' && this.previousOperand !== '') {
                     this.operation = operation;
                     this.updateDisplay();
                     return;
                }
                
                if (this.previousOperand !== '') {
                    this.compute();
                }
                this.operation = operation;
                this.previousOperand = this.currentOperand;
                this.currentOperand = '';
                this.isResultDisplayed = false;
                this.updateDisplay();
            }

            compute() {
                if (this.currentOperand === 'Error') return;
                let computation;
                const prev = parseFloat(this.previousOperand);
                const current = parseFloat(this.currentOperand);

                if (isNaN(prev) || isNaN(current)) {
                    // If previous is not set, but current is (e.g. "5 ="), just show current.
                    if (!isNaN(current) && this.operation === undefined) {
                         this.currentOperand = current.toString();
                         this.isResultDisplayed = true;
                         this.updateDisplay();
                         return;
                    }
                     // If one of them is not a number and an operation is set, it's an incomplete operation.
                     // For instance, if user presses "5 + =", it should ideally not compute or show error.
                     // Or, if only "previousOperand" is set and user presses "=", do nothing.
                    return;
                }

                switch (this.operation) {
                    case '+':
                        computation = prev + current;
                        break;
                    case '-':
                        computation = prev - current;
                        break;
                    case '×':
                        computation = prev * current;
                        break;
                    case '÷':
                        if (current === 0) {
                            this.currentOperand = 'Error';
                            this.previousOperand = '';
                            this.operation = undefined;
                            this.isResultDisplayed = true;
                            this.updateDisplay();
                            return;
                        }
                        computation = prev / current;
                        break;
                    default:
                        return;
                }
                
                // Handle precision for floating point numbers (e.g., 0.1 + 0.2)
                // Limit to a reasonable number of decimal places to avoid long floating point issues
                if (computation % 1 !== 0) { // Check if it's a float
                    computation = parseFloat(computation.toPrecision(12)); // toPrecision to handle floating point arithmetic
                }
                
                this.currentOperand = computation.toString();
                if (this.currentOperand.length > this.MAX_DISPLAY_LENGTH) {
                    // If too long, try toFixed or toExponential. For simplicity, allow overflow or indicate error.
                    // For now, we'll rely on the display-text CSS to handle visual overflow.
                    // Could also do: this.currentOperand = computation.toExponential(9);
                }

                this.operation = undefined;
                this.previousOperand = '';
                this.isResultDisplayed = true;
                this.updateDisplay();
            }

            getDisplayNumber(number) {
                if (number === 'Error') return 'Error';
                const stringNumber = number.toString();
                const integerDigits = parseFloat(stringNumber.split('.')[0]);
                const decimalDigits = stringNumber.split('.')[1];
                let integerDisplay;

                if (isNaN(integerDigits)) {
                    integerDisplay = '';
                } else {
                    // Basic formatting for thousands, can be improved for locales
                    // integerDisplay = integerDigits.toLocaleString('en', { maximumFractionDigits: 0 });
                    // Keeping it simple for now to avoid complexity with further input
                    integerDisplay = integerDigits.toString();
                }

                if (decimalDigits != null) {
                    return `${integerDisplay}.${decimalDigits}`;
                } else {
                    return integerDisplay;
                }
            }

            updateDisplay() {
                this.currentOperandTextElement.innerText = this.getDisplayNumber(this.currentOperand);
                if (this.operation != null) {
                    this.previousOperandTextElement.innerText = 
                        `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
                } else {
                    this.previousOperandTextElement.innerText = '';
                }
            }

            // Bonus: Keyboard Support
            registerKeyboardListeners() {
                document.addEventListener('keydown', (event) => {
                    if (event.key >= 0 && event.key <= 9) {
                        this.appendNumber(event.key);
                    } else if (event.key === '.') {
                        this.appendNumber(event.key);
                    } else if (event.key === 'Enter' || event.key === '=') {
                        event.preventDefault(); // Prevent default form submission if inside one
                        this.compute();
                    } else if (event.key === 'Backspace') {
                        this.delete();
                    } else if (event.key === 'Escape') {
                        this.clear();
                    } else if (event.key === '+') {
                        this.chooseOperation('+');
                    } else if (event.key === '-') {
                        this.chooseOperation('-');
                    } else if (event.key === '*') {
                        this.chooseOperation('×');
                    } else if (event.key === '/') {
                        event.preventDefault(); // Prevent browser's quick find
                        this.chooseOperation('÷');
                    }
                });
            }
        }

        // DOM Elements
        const numberButtons = document.querySelectorAll('[data-number]');
        const operationButtons = document.querySelectorAll('[data-operation]');
        const equalsButton = document.querySelector('[data-equals]');
        const deleteButton = document.querySelector('[data-delete]');
        const allClearButton = document.querySelector('[data-all-clear]');
        const previousOperandTextElement = document.querySelector('[data-previous-operand]');
        const currentOperandTextElement = document.querySelector('[data-current-operand]');

        // Initialize Calculator
        const calculator = new Calculator(previousOperandTextElement, currentOperandTextElement);

        // Event Listeners for buttons
        numberButtons.forEach(button => {
            button.addEventListener('click', () => {
                calculator.appendNumber(button.innerText);
            });
        });

        operationButtons.forEach(button => {
            button.addEventListener('click', () => {
                calculator.chooseOperation(button.innerText);
            });
        });

        equalsButton.addEventListener('click', button => {
            calculator.compute();
        });

        allClearButton.addEventListener('click', button => {
            calculator.clear();
        });

        deleteButton.addEventListener('click', button => {
            calculator.delete();
        });

        // Initial display update
        calculator.updateDisplay();

    </script>
</body>
</html>
